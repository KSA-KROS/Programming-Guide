### KROS Robot Programming Guide
# 3. 구조 설계

## Introduction

프로그래밍을 어떻게 할지 결정하는 것은 굉장히 중요한 문제이다. C로 코드를 짜듯이 절차지향형 하드코딩을 하는건 진짜 미친짓이다.

**JAVA는 대표적인 객체지향형 언어(OOP)이기에, 객체의 특성을 최대한 활용하여 코드를 짜면 굉장히 도움이 될 것이다.**
다형성(Polymorphism), 상속(Inheritance), 추상화(Abstration), 그리고 캡슐화(Encapsulation)등을 잘 사용하는게 정말 중요하다.

제대로 설계하고 구조적으로 코드를 작성하면 오류 해결 및 유지 보수에서 굉장한 이점을 경험할 수 있을 것이다. 
또한, 컴퓨터에서 코드가 돌아가는게 아니라 Control Hub에서 돌아가는 만큼 디버깅툴은 절대 못쓰고 그나마 사용할 수 있는 디버깅 방법이 Telemetry를 사용해 출력해가면서 확인하는 방식이지만
얘는 멈춰두는것도 불가능하고, 공간도 좁고, 금방 삭제되기 때문에 디버깅이 정말 어렵다. 따라서 이러한 불상사를 막기 위해서라도 구조를 잘 짜길 바란다.

아래서는 이와 관련한 몇 가지 아이디어를 나열해보겠다. 프로그래밍을 하면서 뭔가 더 좋은 아이디어가 있으면 추가, 수정 바란다.

## I. Hardware Encapsulation

하드웨어들을 보면 각각의 하드웨어들의 설정들이 비슷비슷한 경우가 굉장히 많다. 또한, 기본적으로 FTC SDK는 하드웨어를 Raw하게 조작하는 기능만을 제공하기에 고급 기능들을 구현하고 싶은 경우가 있다.

예를 들어 인코더를 사용하여 DC 모터를 가동할 경우에는 `Move(int pos, double power)` 함수로 미리 목표 위치를 설정해두고, 
`Update()` 함수를 매 loop마다 실행하여 목표값에 도달하면 정지시키고, 외력으로 목표 위치에서 벗어나면 다시 되돌리도록 할 수 있다.

이러한 기능은 매번 만들기 귀찮으며, 버그를 예방하고, 수정을 용이하게 하기 위해 객체화하여 캡슐화 해놓는 것이 좋다.

서보 모터도 원하는 각도로 회전하는데 시간이 필요하기에, 그 시간동안 다른 작업이 덮어씌워지는걸 방지하거나, 타이머를 활용하여 끝났는지 확인해주는 등의 기능은 객체화하여 캡슐화 해놓는 것이 좋다.
센서들도 마찬가지이다. (특히 IMU)

ex) 2022-2023 FTC

## II. Hardware Manager

특정 파트 혹은 전체에서 사용되는 파트들을 관리할 수 있는 클래스를 만들어두면 편하다.

파트 혹은 Op 클래스에서 Hardware Manager 클래스 객체를 만들고, 이 객체에 하드웨어 클래스들을 등록해둔다. (어차피 Java에서 Class는 함수 매개변수로 전달될 때 Call By Reference로 전달되니까 객체가 복사되는건 걱정 안해도 된다.)
등록을 편하게 하기 위해서 다형성을 써보는 것도 좋을 것 같다.

이렇게 파트를 등록해두고, Hardware Manager에서 일괄적으로 각 하드웨어에 대해 `update()` 및 `isFinished()` 검사를 수행해주면 어떠한 하나의 동작을 묶어버림으로써 
하드웨어들에 명령을 주고, 끝날 때까지 여러 하드웨어들을 동시에 구동시키고, 모든 동작이 끝나면 다음 명령을 할당하는 방식으로 프로그래밍 할 수 있다.

ex) 2022-2023 FTC

## III. Part Abstraction

디자인한 로봇은 반드시 여러개의 파트로 구성될 것이다. (구동부, 집게, 리니어 등)

각각의 구동부는 공통적으로 가지게 되는 변수나 명령등이 있다. Hardware Manager는 공통적으로 가지는 대표적인 멤버 변수일 것이고,
그 외에도 만약 위와 같이 명령을 할당하고, `update()`로 각각의 하드웨어들을 동시에 구동시키고, `isFinished()`로 끝날 때 까지 기다린 후에 다음 명령을 할당하는 방식으로 프로그래밍을 할거면
`Commend(String cmd)`같이 명령을 할당하는 함수만 abstract function으로 만들어 각각의 파트들에서 override하여 정의하도록 하고,
명령에 따라 각각의 절차를 순차적을 수행하도록 하는 기능들은 공통된 기능이기에 추상화 가능하다.

ex) 2022-2023 FTC

## Appendix
* 모든 이전 로봇 소스 코드들
